<script context="module">
	export const load = async ({ page, fetch }) => {
		const { name } = page.params;

		const res = await fetch(`/api/getReadme?name=${name}&readme=readme.md`);

		if (res.ok) return { props: { markdown: await res.text(), name } };

		return {
			status: res.status,
			error: new Error(),
		};
	};
</script>

<script>
	import { marked } from 'marked';
	import highlight from 'highlight.js';

	marked.setOptions({
		highlight: (code, lang) => {
			const language = highlight.getLanguage(lang) ? lang : 'plaintext';
			return highlight.highlight(code, { language }).value;
		},
	});

	export let markdown;
	export let name;
</script>

<svelte:head>
	<title>Package | {name}</title>
</svelte:head>

<article
	class="prose prose-a:inline-block prose-a:mr-1 prose-code:rounded-sm prose-code:before:hidden prose-code:after:hidden  prose-headings:py-2 prose-headings:border-b border-slate-200 dark:border-slate-700 prose-slate dark:prose-invert mx-auto my-12 py-12 max-w-screen-lg"
>
	{@html marked(markdown)}
</article>

<style global lang="postcss">
	/*!
  Theme: GitHub Dark Dimmed
  Description: Dark dimmed theme as seen on github.com
  Author: github.com
  Maintainer: @Hirse
  Updated: 2021-05-15
  Colors taken from GitHub's CSS
*/

	.hljs {
		color: #adbac7;
		background: #22272e;
	}

	.hljs-doctag,
	.hljs-keyword,
	.hljs-meta .hljs-keyword,
	.hljs-template-tag,
	.hljs-template-variable,
	.hljs-type,
	.hljs-variable.language_ {
		/* prettylights-syntax-keyword */
		color: #f47067;
	}

	.hljs-title,
	.hljs-title.class_,
	.hljs-title.class_.inherited__,
	.hljs-title.function_ {
		/* prettylights-syntax-entity */
		color: #dcbdfb;
	}

	.hljs-attr,
	.hljs-attribute,
	.hljs-literal,
	.hljs-meta,
	.hljs-number,
	.hljs-operator,
	.hljs-variable,
	.hljs-selector-attr,
	.hljs-selector-class,
	.hljs-selector-id {
		/* prettylights-syntax-constant */
		color: #6cb6ff;
	}

	.hljs-regexp,
	.hljs-string,
	.hljs-meta .hljs-string {
		/* prettylights-syntax-string */
		color: #96d0ff;
	}

	.hljs-built_in,
	.hljs-symbol {
		/* prettylights-syntax-variable */
		color: #f69d50;
	}

	.hljs-comment,
	.hljs-code,
	.hljs-formula {
		/* prettylights-syntax-comment */
		color: #768390;
	}

	.hljs-name,
	.hljs-quote,
	.hljs-selector-tag,
	.hljs-selector-pseudo {
		/* prettylights-syntax-entity-tag */
		color: #8ddb8c;
	}

	.hljs-subst {
		/* prettylights-syntax-storage-modifier-import */
		color: #adbac7;
	}

	.hljs-section {
		/* prettylights-syntax-markup-heading */
		color: #316dca;
		font-weight: bold;
	}

	.hljs-bullet {
		/* prettylights-syntax-markup-list */
		color: #eac55f;
	}

	.hljs-emphasis {
		/* prettylights-syntax-markup-italic */
		color: #adbac7;
		font-style: italic;
	}

	.hljs-strong {
		/* prettylights-syntax-markup-bold */
		color: #adbac7;
		font-weight: bold;
	}

	.hljs-addition {
		/* prettylights-syntax-markup-inserted */
		color: #b4f1b4;
		background-color: #1b4721;
	}

	.hljs-deletion {
		/* prettylights-syntax-markup-deleted */
		color: #ffd8d3;
		background-color: #78191b;
	}

	article.prose {
		@apply font-open;
	}

	.prose a img {
		margin: 0;
	}

	.prose code {
		background: rgb(241, 245, 249);
		padding: 2px;
		border-radius: 2px;
	}

	.dark .prose code {
		background: rgb(51, 65, 85);
	}

	.dark .prose pre code,
	.prose pre code {
		background: none;
		padding: 0px;
		border-radius: 0px;
	}
</style>
